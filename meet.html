<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prayer & Fire ‚Äì Meetings</title>
  <meta name="description" content="Prayer & Fire Meetings ‚Äî free video meetings for the community." />
  <meta name="theme-color" content="#ff6a00" />

  <style>
    :root{
      --bg:#0b0b0f;
      --panel:#111118;
      --border:#24243a;
      --text:#ffffff;
      --muted:rgba(255,255,255,.72);
      --orange:#ff6a00;
      --orange2:#ff7a1a;
      --radius:18px;
      --shadow: 0 16px 40px rgba(0,0,0,.34);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 50% -200px, rgba(255,106,0,.22), transparent 60%),
                  radial-gradient(900px 500px at 90% 0px, rgba(255,106,0,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    /* GitHub Pages path support */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(11,11,15,.72);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .topbar-inner{
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none; color:var(--text);
      font-weight: 900; letter-spacing: .2px;
    }
    .dot{
      width:12px; height:12px; border-radius: 999px;
      background: var(--orange);
      box-shadow: 0 0 0 4px rgba(255,106,0,.18);
    }
    .navbtn{
      text-decoration:none;
      color: var(--text);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
      cursor:pointer;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding: 18px 18px 18px;
    }
    .card{
      border: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    h1{
      margin:0 0 10px;
      font-size: 22px;
      letter-spacing: -0.3px;
    }

    label{
      display:block;
      font-size: 13px;
      font-weight: 800;
      margin: 10px 0 8px;
      color: rgba(255,255,255,.86);
    }
    input{
      width: 100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(15,15,22,.75);
      color: var(--text);
      font-size: 16px;
      outline:none;
    }
    input:focus{
      border-color: rgba(255,106,0,.55);
      box-shadow: 0 0 0 4px rgba(255,106,0,.16);
    }

    .btnrow{
      display:flex;
      gap:10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .btn{
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      font-size: 14px;
      cursor: pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: transform .06s ease, filter .12s ease;
      user-select: none;
      min-height: 44px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, var(--orange2), var(--orange));
      color:#fff;
      min-width: 220px;
    }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color:#fff;
      font-weight: 800;
    }

    .meetWrap{
      display:none;
      margin-top: 14px;
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
      box-shadow: var(--shadow);
    }
    .meetTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:10px;
      padding: 10px 12px;
      background: rgba(255,255,255,.04);
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-weight: 800;
      font-size: 13px;
    }
    #meet{
      width:100%;
      height: calc(100vh - 220px);
      min-height: 540px;
      background: #000;
    }
    .smallnote{
      margin-top:10px;
      font-size:12px;
      color: rgba(255,255,255,.70);
      line-height:1.35;
    }
  </style>

  <script src="https://meet.jit.si/external_api.js"></script>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <a class="brand" id="homeLink" href="/">
        <span class="dot"></span>
        <span>Prayer &amp; Fire</span>
      </a>
      <a class="navbtn" id="backBtn" href="/">‚Üê Back to Home</a>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h1>üî• Prayer &amp; Fire Meetings</h1>

      <label for="code">Meeting Code (example: 1234)</label>
      <input id="code" placeholder="Enter a code or leave blank to auto-generate" autocomplete="off" inputmode="text" />

      <div class="btnrow">
        <button class="btn btn-primary" type="button" onclick="startMeeting()">Start / Join</button>
        <button class="btn btn-ghost" type="button" onclick="copyLink()">Copy Invite Link</button>
        <button class="btn btn-ghost" type="button" onclick="leaveMeeting()">Leave</button>
      </div>

      <div class="smallnote">
        Tip: Everyone must enter the same code to join the same room (example: <b>PrayerFire-1234</b>).<br/>
        This stays on the Prayer &amp; Fire website ‚Äî the meeting is embedded (powered by Jitsi).
      </div>
    </div>

    <div class="meetWrap" id="meetWrap">
      <div class="meetTop">
        <div id="roomLabel">Meeting</div>
        <button class="btn btn-ghost" type="button" onclick="leaveMeeting()" style="min-height:36px;padding:8px 10px;border-radius:12px;">End</button>
      </div>
      <div id="meet"></div>
    </div>
  </div>

<script>
  // GitHub Pages path support (same logic as your index)
  const isGithubPages = location.hostname.endsWith("github.io");
  const BASE = isGithubPages ? "/prayer-and-fire" : "";

  // Fix home/back links so it never feels like "leaving"
  const homeLink = document.getElementById("homeLink");
  const backBtn = document.getElementById("backBtn");
  if (homeLink) homeLink.href = BASE + "/";
  if (backBtn) backBtn.href = BASE + "/";

  let api = null;

  function clean(v){
    return (v || "")
      .trim()
      .replace(/\s+/g, "-")
      .replace(/[^a-zA-Z0-9-_]/g, "");
  }

  function buildRoom(){
    const input = document.getElementById("code").value;
    const code = clean(input);
    if (code.length >= 3) return "PrayerFire-" + code;
    return "PrayerFire-" + Date.now();
  }

  function meetingUrl(room){
    return "https://meet.jit.si/" + encodeURIComponent(room);
  }

  function startMeeting(){
    const room = buildRoom();

    document.getElementById("meetWrap").style.display = "block";
    document.getElementById("roomLabel").textContent = room;

    if (api) {
      try { api.dispose(); } catch(e) {}
      api = null;
      document.getElementById("meet").innerHTML = "";
    }

    api = new JitsiMeetExternalAPI("meet.jit.si", {
      roomName: room,
      parentNode: document.querySelector("#meet"),
      width: "100%",
      height: "100%",
      configOverwrite: {
        startWithAudioMuted: false,
        startWithVideoMuted: false
      },
      interfaceConfigOverwrite: {
        SHOW_JITSI_WATERMARK: false,
        SHOW_WATERMARK_FOR_GUESTS: false
      }
    });

    setTimeout(() => document.getElementById("meetWrap").scrollIntoView({ behavior: "smooth" }), 150);
  }

  async function copyLink(){
    const room = buildRoom();
    const url = meetingUrl(room);
    try {
      await navigator.clipboard.writeText(url);
      alert("Invite link copied:\n" + url);
    } catch (e) {
      prompt("Copy this invite link:", url);
    }
  }

  function leaveMeeting(){
    if (!api) {
      document.getElementById("meetWrap").style.display = "none";
      return;
    }
    try { api.executeCommand("hangup"); } catch(e) {}
    try { api.dispose(); } catch(e) {}
    api = null;
    document.getElementById("meet").innerHTML = "";
    document.getElementById("meetWrap").style.display = "none";
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
</script>
</body>
</html>
